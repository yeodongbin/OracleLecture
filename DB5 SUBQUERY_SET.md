-SubQuery (single row)

문1 평균 급여보다 높은 사원의 이름, 급여를 구하라.
SELECT ENAME, SAL
FROM EMP
WHERE SAL >= (평균급여);

SELECT AVG(SAL)
FROM EMP;
=> 1줄(row)

SELECT ENAME, SAL
FROM EMP
WHERE SAL >= (SELECT AVG(SAL)
	      FROM EMP);

문2 진현무 학생보다 키가 큰 학생들에
    이름, 학번, 키를 출력하시오.

SELECT STU_NAME, STU_NO, STU_HEIGHT
FROM STUDENT
WHERE STU_HEIGHT > (진현무 학생키);

SELECT STU_HEIGHT
FROM STUDENT
WHERE STU_NAME = '진현무';

SELECT STU_NAME, STU_NO, STU_HEIGHT
FROM STUDENT
WHERE STU_HEIGHT > (SELECT STU_HEIGHT
		    FROM STUDENT
		    WHERE STU_NAME = '진현무');

SELECT S1.STU_NAME, S1.STU_NO, S1.STU_HEIGHT
FROM STUDENT S1, STUDENT S2
WHERE S1.STU_HEIGHT > S2.STU_HEIGHT
AND S2.STU_NAME = '진현무';

문3 학과별 평균 신장 중 가장 높은 평균 신장, 학과 번호
    을 출력하시오.
SELECT MAX(AVG(STU_HEIGHT))
FROM STUDENT
GROUP BY STU_DEPT;

SELECT STU_DEPT, AVG(STU_HEIGHT)
FROM STUDENT
GROUP BY STU_DEPT
HAVING AVG(STU_HEIGHT) = (SELECT MAX(AVG(STU_HEIGHT))
			  FROM STUDENT
			  GROUP BY STU_DEPT);

문4 부서 평균 급여가 전체 직원 평균 급여보다 
    많은 부서의 이름, 부서 평균 급여를 출력하시오.
SELECT DNAME, ROUND(AVG(SAL))
FROM EMP NATURAL JOIN DEPT
GROUP BY DEPTNO, DNAME
HAVING AVG(SAL) > (SELECT AVG(SAL)
	           FROM EMP);

문5 SCOTT 사원보다 많은 급여를 받는 사원 정보를 
    출력하시오.
SELECT * 
FROM EMP
WHERE SAL > (SELECT SAL
	     FROM EMP
	     WHERE ENAME = 'SCOTT');

문6 기계과 학생들 중 학년별 평균 신장이 160이상인
    학년과 평균 신장을 출력하시오.
SELECT STU_GRADE, AVG(STU_HEIGHT)
FROM STUDENT
WHERE STU_DEPT = '기계'
GROUP BY STU_GRADE
HAVING AVG(STU_HEIGHT) >= 160;

SELECT STU_GRADE, AVG
FROM (기계과 학년별 평균 신장)
WHERE AVG >= 160

SELECT STU_GRADE, AVG
FROM (SELECT STU_GRADE, AVG(STU_HEIGHT) AS AVG
      FROM STUDENT
      WHERE STU_DEPT = '기계'
      GROUP BY STU_GRADE)
WHERE AVG >= 160

문7 CHICAGO에서 근무하지 않은 모든 사원의 정보를 
    출력하시오.
SELECT * 
FROM EMP
WHERE DEPTNO != (CHICAGO에서 근무하는 부서)

SELECT DEPTNO
FROM DEPT
WHERE LOC ='CHICAGO'

SELECT * 
FROM EMP
WHERE DEPTNO != (SELECT DEPTNO
		 FROM DEPT
	         WHERE LOC ='CHICAGO');

문8 20번 부서의 최대급여보다 최대급여가 많은
    부서의 부서번호, 부서이름, 최대급여를 검색하시오.
SELECT EMP.DEPTNO, DEPT.DNAME, MAX(EMP.SAL)
FROM EMP JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO
GROUP BY EMP.DEPTNO, DEPT.DNAME
HAVING MAX(EMP.SAL) > (20번 부서의 최대급여);

SELECT MAX(SAL)
FROM EMP
WHERE DEPTNO = 20

SELECT EMP.DEPTNO, DEPT.DNAME, MAX(EMP.SAL)
FROM EMP JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO
GROUP BY EMP.DEPTNO, DEPT.DNAME
HAVING MAX(EMP.SAL) > (SELECT MAX(SAL)
		       FROM EMP
		       WHERE DEPTNO = 20);

문9 SALESMAN의 커미션 평균을 출력하시오.
SELECT AVG(NVL(COMM,0))
FROM EMP
WHERE JOB = 'SALESMAN'; 

SELECT AVG(COM)
FROM (SELECT NVL(COMM,0) AS COM
      FROM EMP
      WHERE JOB = 'SALESMAN');

문10 학과별 평균몸무게보다 몸무게가 많은 학과별 
     학생들의 학번, 이름, 학과명, 몸무게를 출력하시오.
SELECT STUDENT.STU_NO, STUDENT.STU_NAME, STUDENT.STU_DEPT, STU_WEIGHT
FROM STUDENT, (SELECT STU_DEPT, AVG(STU_WEIGHT) AVG_WEIGHT
	       FROM STUDENT
               GROUP BY STU_DEPT) STUDENT_B
WHERE STUDENT.STU_DEPT = STUDENT_B.STU_DEPT
AND STUDENT.STU_WEIGHT > AVG_WEIGHT;

- 복수열 서브쿼리
문 11 각 부서별 최소 급여를 받는 사원의 
      이름과 급여를 구하라
SELECT ENAME, SAL
FROM EMP
WHERE SAL = (각 부서별 최소 급여)

SELECT MIN(SAL)
FROM EMP
GROUP BY DEPTNO;

SELECT ENAME, SAL
FROM EMP
WHERE (DEPTNO,SAL) IN (SELECT DEPTNO, MIN(SAL)
	               FROM EMP
	               GROUP BY DEPTNO);


문12 20번 부서 사원의 사원 직무와 같은 사원직무인 
다른 부서의 사원 정보를 검색하라 (in, any, some)

SELECT * 
FROM EMP
WHERE DEPTNO <> 20
AND JOB IN (SELECT DISTINCT JOB
            FROM EMP
            WHERE DEPTNO = 20);

SELECT * 
FROM EMP
WHERE DEPTNO <> 20
AND JOB = ANY (SELECT DISTINCT JOB
               FROM EMP
               WHERE DEPTNO = 20);

SELECT * 
FROM EMP
WHERE DEPTNO <> 20
AND JOB = SOME (SELECT DISTINCT JOB
                FROM EMP
                WHERE DEPTNO = 20);
문13 부서별로 가장 급여를 많이 받는 사원의 정보를 출력하시오.
SELECT * 
FROM EMP
WHERE (DEPTNO, SAL) = (SELECT DEPTNO, MAX(SAL)
		       FROM EMP
		       GROUP BY DEPTNO);

문14 직급이 매니저인 사람이 속한 부서명, 부서번호, 지역을
     출력하시오.
SELECT DISTINCT DNAME, DEPTNO, LOC
FROM EMP NATURAL JOIN DEPT
WHERE DEPTNO IN (SELECT DEPTNO
		 FROM EMP
		 WHERE JOB = 'MANAGER');

문15 영업 사원이 받은 최소 급여보다 많이 받는 사원들의
     이름, 급여를 출력하시오. (ANY)
     (부서번호 20은 제외할 것)

SELECT ENAME, SAL, DEPTNO
FROM EMP
WHERE SAL > ANY (SELECT SAL
		 FROM EMP
		 WHERE JOB = 'SALESMAN')
AND DEPTNO != 20;


문16 급여가 모든 부서들의 평균 급여보다 많은 
     사원 정보를 검색하라.(ALL)
SELECT * 
FROM EMP
WHERE SAL > ALL(SELECT AVG(SAL)
	        FROM EMP
	        GROUP BY DEPTNO);

문17 영업 사원들 보다 급여를 많이 받는 사원의 
     사원이름, 급여를 출력하시오.(ALL)
SELECT ENAME, SAL
FROM EMP
WHERE SAL > ALL (SELECT SAL
                 FROM EMP
                 WHERE JOB ='SALESMAN');

-seT

SELECT * FROM EMP WHERE DEPTNO IN (10, 20);

SELECT * FROM EMP WHERE DEPTNO = 20
UNION
SELECT * FROM EMP WHERE DEPTNO = 10;

SELECT * FROM EMP WHERE DEPTNO = 20
UNION ALL
SELECT * FROM EMP WHERE DEPTNO = 10;

SELECT * FROM EMP WHERE DEPTNO = 20
INTERSECT
SELECT * FROM EMP WHERE DEPTNO = 10;

SELECT * FROM EMP WHERE DEPTNO = 20
MINUS
SELECT * FROM EMP WHERE DEPTNO = 10;


문18 전기전자과인 학생들과 컴퓨터 정보과인 학생들의 
     전체정보를 나타내시오.
SELECT * FROM STUDENT WHERE STU_DEPT = '전기전자'
UNION
SELECT * FROM STUDENT WHERE STU_DEPT = '컴퓨터정보';

문19 전체 학생 정보에서 1학년 학생 정보를 제외하고
     전체정보를 출력하시오.
SELECT * FROM STUDENT
MINUS
SELECT * FROM STUDENT WHERE STU_GRADE = 1;

문20 전체 학생정보에서 기계과이면서 1학년생인 정보를
     출력하시오.
SELECT * FROM STUDENT
INTERSECT
SELECT * FROM STUDENT WHERE STU_DEPT = '기계'
AND STU_GRADE = 1;

문21 컴퓨터정보과의 최소 신장과 각 학과 최소신장을 가진 학생을 
    비교하여 컴퓨터 정보과 최소 신장보다 큰 학과의 학과명과
    최소 신장을 출력하시오.

SELECT DEPT, MIN_HEIGHT
FROM (SELECT STU_DEPT DEPT, MIN(STU_HEIGHT) MIN_HEIGHT
      FROM STUDENT
      GROUP BY STU_DEPT) STUDENT_A
WHERE MIN_HEIGHT > (SELECT MIN(STU_HEIGHT)
		    FROM STUDENT
		    WHERE STU_DEPT = '컴퓨터정보');

문22 학번, 학생명, 과명(기계, 전기전자 등), 키, 
     학생이 소속된 과의 평균키를 출력하시오.
SELECT STU_NO, STU_NAME, STUDENT.STU_DEPT, 
       STU_HEIGHT, AVG_HEIGHT
FROM STUDENT, (SELECT STU_DEPT, ROUND(AVG(STU_HEIGHT)) AVG_HEIGHT
	       FROM STUDENT
	       GROUP BY STU_DEPT) DEPT_AVG_HEIGHT
WHERE STUDENT.STU_DEPT = DEPT_AVG_HEIGHT.STU_DEPT;

문23 SALESMAN 이지만, 보너스를 받지 않는 사원의
     정보를 모두 출력하시오. (set)

SELECT * 
FROM EMP
WHERE JOB = 'SALESMAN'
INTERSECT
SELECT * 
FROM EMP
WHERE COMM IS NULL;

SELECT * 
FROM EMP
WHERE JOB ='SALESMAN'
MINUS
SELECT * 
FROM EMP
WHRE COMM IS NOT NULL;

P163
문24 컴퓨터정보과 학생들 중 평균점수가 최고인 학생의 
     학번, 이름, 평균점수를 검색하라
SELECT STUDENT.STU_NO, STU_NAME, 
       AVG(enrol.enr_grade) AVG_GRADE
FROM STUDENT, ENROL
WHERE STUDENT.STU_NO = ENROL.STU_NO
AND STU_DEPT = '컴퓨터정보'
GROUP BY STUDENT.STU_NO, STUDENT.STU_NAME
HAVING AVG(enrol.enr_grade) >= ALL (SELECT AVG(enrol.enr_grade)
		                    FROM STUDENT, ENROL
                                    WHERE STUDENT.STU_NO = ENROL.STU_NO
                                    AND STU_DEPT = '컴퓨터정보'
                                    GROUP BY STUDENT.STU_NO)

SELECT STUNO, STUNAME, AVG_GRADE
FROM (SELECT STUDENT.STU_NO STUNO, STU_NAME STUNAME, 
      AVG(enrol.enr_grade) AVG_GRADE
      FROM STUDENT, ENROL
      WHERE STUDENT.STU_NO = ENROL.STU_NO
      AND STU_DEPT = '컴퓨터정보'
      GROUP BY STUDENT.STU_NO, STUDENT.STU_NAME) COM_STUDENT
WHERE AVG_GRADE = (SELECT MAX(AVG_GRADE)
                   FROM (SELECT STUDENT.STU_NO STUNO, STU_NAME STUNAME, 
                         AVG(enrol.enr_grade) AVG_GRADE
                         FROM STUDENT, ENROL
                         WHERE STUDENT.STU_NO = ENROL.STU_NO
                         AND STU_DEPT = '컴퓨터정보'
                         GROUP BY STUDENT.STU_NO, STUDENT.STU_NAME) COM_STUDENT);


문25 컴퓨터개론과 시스템분석설계 과목을 동시에 수강하는 
     학생의 학번, 이름, 학번 순으로 검색하라.(AND)

- SET(0)
SELECT DISTINCT STUDENT.STU_NO, STUDENT.STU_NAME
FROM STUDENT, ENROL, SUBJECT
WHERE STUDENT.STU_NO = ENROL.STU_NO
AND ENROL.SUB_NO = SUBJECT.SUB_NO
AND SUBJECT.SUB_NAME = '컴퓨터개론'
INTERSECT
SELECT DISTINCT STUDENT.STU_NO, STUDENT.STU_NAME
FROM STUDENT, ENROL, SUBJECT
WHERE STUDENT.STU_NO = ENROL.STU_NO
AND ENROL.SUB_NO = SUBJECT.SUB_NO
AND SUBJECT.SUB_NAME = '시스템분석설계'

X
SELECT A.STUNO, A.STUNAME
FROM 
(SELECT DISTINCT STUDENT.STU_NO STUNO, STUDENT.STU_NAME STUNAME
FROM STUDENT, ENROL, SUBJECT 
WHERE STUDENT.STU_NO = ENROL.STU_NO
AND ENROL.SUB_NO = SUBJECT .SUB_NO
AND SUBJECT.SUB_NAME = '컴퓨터개론') A,
(SELECT DISTINCT STUDENT.STU_NO STUNO, STUDENT.STU_NAME STUNAME
FROM STUDENT, ENROL, SUBJECT
WHERE STUDENT.STU_NO = ENROL.STU_NO
AND ENROL.SUB_NO = SUBJECT.SUB_NO
AND SUBJECT.SUB_NAME = '시스템분석설계') B
WHERE A.STUNO = B.STUNO
